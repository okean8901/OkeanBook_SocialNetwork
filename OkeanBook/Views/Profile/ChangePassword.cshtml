@model OkeanBook.Models.ViewModels.ChangePasswordViewModel

@{
    ViewData["Title"] = "Đổi mật khẩu";
}

<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900/20 to-slate-900 py-8">
    <div class="max-w-xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 shadow-2xl overflow-hidden">
            <div class="p-6 border-b border-white/20 bg-gradient-to-r from-purple-500/10 to-blue-500/10">
                <h5 class="text-white font-bold text-xl flex items-center">
                    <i class="fas fa-key text-purple-300 mr-3"></i>
                    Đổi mật khẩu
                </h5>
            </div>
            <div class="p-8">
                <form asp-action="ChangePassword" method="post" class="space-y-6">
                    <div asp-validation-summary="ModelOnly" class="px-4 py-3 rounded-2xl bg-red-500/10 border border-red-500/30 text-red-300"></div>

                    <!-- Current Password -->
                    <div>
                        <label asp-for="CurrentPassword" class="block text-white/80 font-semibold mb-2">Mật khẩu hiện tại</label>
                        <div class="relative">
                            <input asp-for="CurrentPassword" type="password" id="currentPassword" class="w-full px-5 py-3 rounded-2xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400/50 pr-12" />
                            <button type="button" class="absolute inset-y-0 right-3 text-white/60 hover:text-white" id="toggleCurrent">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span asp-validation-for="CurrentPassword" class="text-red-400 text-sm"></span>
                    </div>

                    <!-- New Password -->
                    <div>
                        <label asp-for="NewPassword" class="block text-white/80 font-semibold mb-2">Mật khẩu mới</label>
                        <div class="relative">
                            <input asp-for="NewPassword" type="password" id="newPassword" class="w-full px-5 py-3 rounded-2xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400/50 pr-12" />
                            <button type="button" class="absolute inset-y-0 right-3 text-white/60 hover:text-white" id="toggleNew">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <!-- Strength bar -->
                        <div class="mt-2 flex items-center space-x-2">
                            <div class="flex-1 h-2 bg-white/10 rounded-full overflow-hidden border border-white/10">
                                <div id="strengthBar" class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full" style="width: 0%"></div>
                            </div>
                            <span id="strengthText" class="text-xs text-white/60">Yếu</span>
                        </div>
                        <span asp-validation-for="NewPassword" class="text-red-400 text-sm"></span>
                    </div>

                    <!-- Confirm Password -->
                    <div>
                        <label asp-for="ConfirmNewPassword" class="block text-white/80 font-semibold mb-2">Xác nhận mật khẩu mới</label>
                        <div class="relative">
                            <input asp-for="ConfirmNewPassword" type="password" id="confirmPassword" class="w-full px-5 py-3 rounded-2xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400/50 pr-12" />
                            <button type="button" class="absolute inset-y-0 right-3 text-white/60 hover:text-white" id="toggleConfirm">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div id="matchHint" class="mt-2 hidden text-green-400 text-sm">
                            <i class="fas fa-check-circle mr-1"></i>Mật khẩu khớp
                        </div>
                        <span asp-validation-for="ConfirmNewPassword" class="text-red-400 text-sm"></span>
                    </div>

                    <div class="flex justify-end space-x-3 pt-2">
                        <a asp-action="Index" class="px-6 py-3 rounded-2xl bg-white/10 hover:bg-white/20 text-white border border-white/20 transition-colors">Hủy</a>
                        <button type="submit" class="px-6 py-3 rounded-2xl bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold shadow-lg transition-all">
                            <i class="fas fa-save mr-2"></i>Đổi mật khẩu
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        function togglePassword(inputId, iconBtnId) {
            const input = document.getElementById(inputId);
            const btn = document.getElementById(iconBtnId);
            const icon = btn.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function strengthOf(pw) {
            let s = 0;
            if (pw.length >= 8) s += 25;
            if (/[a-z]/.test(pw)) s += 25;
            if (/[A-Z]/.test(pw)) s += 25;
            if (/[0-9]|[^A-Za-z]/.test(pw)) s += 25;
            return s;
        }

        function updateStrengthBar(val) {
            const bar = document.getElementById('strengthBar');
            const text = document.getElementById('strengthText');
            bar.style.width = val + '%';
            if (val <= 25) { text.textContent = 'Yếu'; text.className = 'text-xs text-red-400'; }
            else if (val <= 50) { text.textContent = 'Trung bình'; text.className = 'text-xs text-yellow-400'; }
            else if (val <= 75) { text.textContent = 'Khá'; text.className = 'text-xs text-blue-400'; }
            else { text.textContent = 'Mạnh'; text.className = 'text-xs text-green-400'; }
        }

        function checkMatch() {
            const pw = document.getElementById('newPassword').value;
            const cf = document.getElementById('confirmPassword').value;
            const hint = document.getElementById('matchHint');
            if (cf && pw === cf) hint.classList.remove('hidden'); else hint.classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('toggleCurrent').addEventListener('click', () => togglePassword('currentPassword', 'toggleCurrent'));
            document.getElementById('toggleNew').addEventListener('click', () => togglePassword('newPassword', 'toggleNew'));
            document.getElementById('toggleConfirm').addEventListener('click', () => togglePassword('confirmPassword', 'toggleConfirm'));
            document.getElementById('newPassword').addEventListener('input', (e) => updateStrengthBar(strengthOf(e.target.value)));
            document.getElementById('confirmPassword').addEventListener('input', checkMatch);
        });
    </script>
}
